<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Baseball Draft</title>
    <link href="output.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-baseball-primary to-baseball-secondary min-h-screen text-white">
    <div class="max-w-4xl mx-auto px-6 py-10">
        <div class="text-center mb-10">
            <h1 class="text-5xl font-bold mb-4">âš¾ Advanced Baseball Draft</h1>
            <p class="text-xl opacity-90">ESPN-style fantasy with advanced stats that actually matter</p>
        </div>
        
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 border border-white/20">
            <form id="createLeagueForm" class="space-y-6">
                <div>
                    <label for="leagueName" class="block text-lg font-semibold mb-2">League Name</label>
                    <input type="text" id="leagueName" name="leagueName" placeholder="The Barrel Kings" required
                           class="w-full p-3 bg-white/10 border-2 border-white/30 rounded-lg text-white placeholder-white/70 focus:border-blue-400 focus:bg-white/20 transition-all">
                </div>
                
                <div>
                    <label for="creatorName" class="block text-lg font-semibold mb-2">Your Name</label>
                    <input type="text" id="creatorName" name="creatorName" placeholder="Commissioner Name" required
                           class="w-full p-3 bg-white/10 border-2 border-white/30 rounded-lg text-white placeholder-white/70 focus:border-blue-400 focus:bg-white/20 transition-all">
                </div>
                
                <div>
                    <label for="maxTeams" class="block text-lg font-semibold mb-2">Number of Teams</label>
                    <select id="maxTeams" name="maxTeams" required
                            class="w-full p-3 bg-white/10 border-2 border-white/30 rounded-lg text-white focus:border-blue-400 focus:bg-white/20 transition-all">
                        <option value="">Select team count</option>
                        <option value="8">8 Teams</option>
                        <option value="10">10 Teams</option>
                        <option value="12">12 Teams</option>
                    </select>
                </div>
                
                <div>
                    <label for="statPackage" class="block text-lg font-semibold mb-2">Stat Package</label>
                    <select id="statPackage" name="statPackage" required
                            class="w-full p-3 bg-white/10 border-2 border-white/30 rounded-lg text-white focus:border-blue-400 focus:bg-white/20 transition-all">
                        <option value="">Loading stat packages...</option>
                    </select>
                    
                    <div id="statPackagePreview" class="mt-4 bg-white/10 rounded-lg p-4 border border-white/20" style="display: none;"></div>
                </div>
                
                <button type="submit" id="createButton"
                        class="w-full bg-gradient-to-r from-baseball-accent to-green-600 text-white border-none py-4 rounded-lg text-lg font-semibold cursor-pointer transition-all hover:-translate-y-1 hover:shadow-lg disabled:bg-white/30 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none">
                    Create League
                </button>
            </form>
            
            <div id="successMessage" class="mt-6 bg-baseball-accent/20 border border-baseball-accent/50 rounded-lg p-4 text-center" style="display: none;"></div>
        </div>
    </div>
    
    <script>
        let statPackages = [];
        
        // Load stat packages on page load
        async function loadStatPackages() {
            try {
                const response = await fetch('/api/stat-packages');
                const data = await response.json();
                
                const select = document.getElementById('statPackage');
                
                if (!response.ok || data.error) {
                    console.error('API Error:', data.error || 'Unknown error');
                    select.innerHTML = `<option value="">Error: ${data.error || 'Unknown error'}</option>`;
                    return;
                }
                
                if (!Array.isArray(data)) {
                    console.error('Expected array, got:', typeof data, data);
                    select.innerHTML = '<option value="">Error: Invalid data format</option>';
                    return;
                }
                
                statPackages = data;
                select.innerHTML = '<option value="">Choose your stat philosophy</option>';
                
                statPackages.forEach(pkg => {
                    const option = document.createElement('option');
                    option.value = pkg.id;
                    option.textContent = pkg.name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading stat packages:', error);
                document.getElementById('statPackage').innerHTML = '<option value="">Network error</option>';
            }
        }
        
        // Show stat package preview
        function showStatPackagePreview(packageId) {
            const pkg = statPackages.find(p => p.id === packageId);
            const preview = document.getElementById('statPackagePreview');
            
            if (!pkg) {
                preview.style.display = 'none';
                return;
            }
            
            preview.style.display = 'block';
            preview.innerHTML = `
                <h4 class="text-lg font-bold text-blue-300 mb-2">${pkg.name}</h4>
                <p class="text-sm opacity-90 italic mb-4">${pkg.philosophy}</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h5 class="text-sm font-semibold text-blue-200 mb-2">Hitting Categories</h5>
                        <div class="flex flex-wrap gap-1">
                            ${pkg.hitting_categories.map(cat => `<span class="bg-blue-500/30 px-2 py-1 rounded text-xs border border-blue-500/50">${cat}</span>`).join('')}
                        </div>
                    </div>
                    <div>
                        <h5 class="text-sm font-semibold text-blue-200 mb-2">Pitching Categories</h5>
                        <div class="flex flex-wrap gap-1">
                            ${pkg.pitching_categories.map(cat => `<span class="bg-blue-500/30 px-2 py-1 rounded text-xs border border-blue-500/50">${cat}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Handle form submission
        async function createLeague(event) {
            event.preventDefault();
            
            const button = document.getElementById('createButton');
            button.disabled = true;
            button.textContent = 'Creating League...';
            
            const formData = new FormData(event.target);
            const data = {
                name: formData.get('leagueName'),
                creator_name: formData.get('creatorName'),
                max_teams: parseInt(formData.get('maxTeams')),
                stat_package: formData.get('statPackage')
            };
            
            try {
                const response = await fetch('/api/rooms', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    const successDiv = document.getElementById('successMessage');
                    successDiv.style.display = 'block';
                    successDiv.innerHTML = `
                        <h3 class="text-xl font-bold mb-3">ðŸŽ‰ League Created Successfully!</h3>
                        <p class="mb-2"><strong>League ID:</strong> ${result.roomId}</p>
                        <p class="mb-2"><strong>Share this link with your friends:</strong></p>
                        <div class="bg-white/10 border border-white/30 rounded p-3 my-3 font-mono text-sm break-all">${result.shareUrl}</div>
                        <p class="mt-3">
                            <a href="${result.shareUrl}" class="text-blue-300 hover:text-blue-200 underline">Join your league â†’</a>
                        </p>
                    `;
                    
                    // Hide the form
                    event.target.style.display = 'none';
                } else {
                    alert('Error creating league: ' + result.error);
                }
            } catch (error) {
                console.error('Error creating league:', error);
                alert('Error creating league. Please try again.');
            } finally {
                button.disabled = false;
                button.textContent = 'Create League';
            }
        }
        
        // Event listeners
        document.getElementById('statPackage').addEventListener('change', (e) => {
            showStatPackagePreview(e.target.value);
        });
        
        document.getElementById('createLeagueForm').addEventListener('submit', createLeague);
        
        // Load stat packages when page loads
        loadStatPackages();
    </script>
</body>
</html>